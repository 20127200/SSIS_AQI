WITH 
    MEMBER [Measures].[Max AQI] AS
        MAX(
            EXISTING [Dim Date].[Day].[Day].MEMBERS,
            [Measures].[Aqi]
        )
    MEMBER [Measures].[Min AQI] AS
        MIN(
            EXISTING [Dim Date].[Day].[Day].MEMBERS,
            [Measures].[Aqi]
        )
SELECT 
    {
        [Measures].[Max AQI],
        [Measures].[Min AQI]
    } ON COLUMNS,
    NON EMPTY 
    (
        [Dim County].[State Name].[State Name] *
        [Dim Date].[Year].[Year] *
        [Dim Date].[Quarter].[Quarter]
    ) ON ROWS
FROM [AQI DDS]

WITH 
    -- Tính giá trị trung bình AQI
    MEMBER [Measures].[Average AQI] AS
        AVG(
            EXISTING [Dim Date].[Day].[Day].MEMBERS,
            [Measures].[Aqi]
        )

    -- Tính độ lệch chuẩn AQI
    MEMBER [Measures].[Standard Deviation AQI] AS
        STDEV(
            EXISTING [Dim Date].[Day].[Day].MEMBERS,
            [Measures].[Aqi]
        )

SELECT 
    {
        [Measures].[Average AQI],
        [Measures].[Standard Deviation AQI]
    } ON COLUMNS,
    
    FILTER(
        (
            [Dim County].[State Name].[State Name].Members,
            [Dim Date].[Year].[Year].Members,
            [Dim Date].[Quarter].[Quarter].Members
        ),
        NOT IsEmpty([Measures].[Average AQI])
        AND NOT IsEmpty([Measures].[Standard Deviation AQI])
    ) ON ROWS

FROM [AQI DDS]


WITH 
MEMBER [Measures].[Unhealthy Days Count] AS
    SUM(
        FILTER(
            [Dim Category].[Category Name].MEMBERS,
            [Dim Category].[Category Name].CURRENTMEMBER.NAME = "Very Unhealthy"
            OR [Dim Category].[Category Name].CURRENTMEMBER.NAME = "Hazardous"
        ),
        [Measures].[Fact Aqi Count]
    )

MEMBER [Measures].[Average AQI] AS
    AVG(
        FILTER(
            [Dim Category].[Category Name].MEMBERS,
            [Dim Category].[Category Name].CURRENTMEMBER.NAME = "Very Unhealthy"
            OR [Dim Category].[Category Name].CURRENTMEMBER.NAME = "Hazardous"
        ),
        [Measures].[Aqi]
    )

SELECT 
    {
        [Measures].[Unhealthy Days Count], 
        [Measures].[Average AQI]
    } ON COLUMNS,
    NONEMPTY(
        CROSSJOIN(
            [Dim County].[State Name].[State Name].MEMBERS, 
            [Dim County].[County Name].[County Name].MEMBERS
        ),
        {[Measures].[Unhealthy Days Count], [Measures].[Average AQI]}
    ) ON ROWS
FROM [AQI DDS]
WHERE 
    ([Dim Date].[Year].MEMBERS);


WITH 
MEMBER [Measures].[Days Count] AS
    COUNT(
        NONEMPTY(
            [Dim Date].[Day].MEMBERS,
            [Measures].[Fact Aqi Count]
        )
    )

SELECT 
    {
        [Measures].[Days Count]
    } ON COLUMNS,
    NONEMPTY(
        FILTER(
            CROSSJOIN(
                [Dim County].[State Name].[State Name].MEMBERS,
                [Dim County].[County Name].[County Name].MEMBERS,
                [Dim Category].[Category Name].[Category Name].MEMBERS
            ),
            [Dim County].[State Name].CURRENTMEMBER.NAME = "Hawaii"
            OR [Dim County].[State Name].CURRENTMEMBER.NAME = "Alaska"
            OR [Dim County].[State Name].CURRENTMEMBER.NAME = "Illinois"
            OR [Dim County].[State Name].CURRENTMEMBER.NAME = "Delaware"
        ),
        [Measures].[Fact Aqi Count]
    ) ON ROWS
FROM [AQI DDS];


WITH 
MEMBER [Measures].[Average AQI] AS
    AVG(
        NONEMPTY(
            [Dim Date].[Day].MEMBERS,
            [Measures].[Aqi]
        ),
        [Measures].[Aqi]
    )

SELECT 
    NONEMPTY(
        CROSSJOIN(
            FILTER(
                [Dim Date].[Year].[Year].MEMBERS,
                [Dim Date].[Year].CURRENTMEMBER.NAME <> "Unknown" -- Lọc bỏ Year "Unknown"
            ),
            FILTER(
                [Dim Date].[Quarter].[Quarter].MEMBERS,
                [Dim Date].[Quarter].CURRENTMEMBER.NAME <> "Unknown" -- Lọc bỏ Quarter "Unknown"
            )
        )
    ) ON COLUMNS,
    NONEMPTY(
        FILTER(
            [Dim County].[State Name].[State Name].MEMBERS,
            [Dim County].[State Name].CURRENTMEMBER.NAME = "Hawaii"
            OR [Dim County].[State Name].CURRENTMEMBER.NAME = "Alaska"
            OR [Dim County].[State Name].CURRENTMEMBER.NAME = "Illinois"
            OR [Dim County].[State Name].CURRENTMEMBER.NAME = "Delaware"
        )
    ) ON ROWS
FROM [AQI DDS]
WHERE [Measures].[Average AQI];

WITH 
MEMBER [Measures].[Average AQI] AS
    AVG(
        NONEMPTY(
            [Dim Date].[Day].MEMBERS,
            [Measures].[Aqi]
        ),
        [Measures].[Aqi]
    )

SELECT 
    NONEMPTY(
        ORDER(
            CROSSJOIN(
                FILTER(
                    [Dim Date].[Year].[Year].MEMBERS,
                    NOT [Dim Date].[Year].CURRENTMEMBER.NAME = "Unknown" -- Loại bỏ Year "Unknown"
                ),
                FILTER(
                    [Dim Date].[Month].[Month].MEMBERS,
                    NOT [Dim Date].[Month].CURRENTMEMBER.NAME = "Unknown" -- Loại bỏ Month "Unknown"
                )
            ),
            [Dim Date].[Year].CURRENTMEMBER.UNIQUENAME + [Dim Date].[Month].CURRENTMEMBER.UNIQUENAME, BASC -- Sắp xếp theo Năm và Tháng
        )
    ) ON COLUMNS,
    NONEMPTY(
        FILTER(
            [Dim County].[State Name].[State Name].MEMBERS,
            [Dim County].[State Name].CURRENTMEMBER.NAME = "Hawaii"
            OR [Dim County].[State Name].CURRENTMEMBER.NAME = "Alaska"
            OR [Dim County].[State Name].CURRENTMEMBER.NAME = "Illinois"
            OR [Dim County].[State Name].CURRENTMEMBER.NAME = "California"
        )
    ) ON ROWS
FROM [AQI DDS]
WHERE [Measures].[Average AQI];




WITH 
MEMBER [Measures].[Mean AQI] AS
    AVG(
        NONEMPTY(
            [Dim Date].[Day].MEMBERS,
            [Measures].[Aqi]
        ),
        [Measures].[Aqi]
    )

MEMBER [Measures].[Standard Deviation AQI] AS
    STDDEV(
        NONEMPTY(
            [Dim Date].[Day].MEMBERS,
            [Measures].[Aqi]
        ),
        [Measures].[Aqi]
    )

MEMBER [Measures].[Min AQI] AS
    MIN(
        NONEMPTY(
            [Dim Date].[Day].MEMBERS,
            [Measures].[Aqi]
        ),
        [Measures].[Aqi]
    )

MEMBER [Measures].[Max AQI] AS
    MAX(
        NONEMPTY(
            [Dim Date].[Day].MEMBERS,
            [Measures].[Aqi]
        ),
        [Measures].[Aqi]
    )

SELECT 
    {
        [Measures].[Mean AQI],
        [Measures].[Standard Deviation AQI],
        [Measures].[Min AQI],
        [Measures].[Max AQI]
    } ON COLUMNS,
    NONEMPTY(
        CROSSJOIN(
            [Dim Date].[Year].[Year].MEMBERS, -- Hiển thị Năm
            [Dim Date].[Quarter].[Quarter].MEMBERS, -- Hiển thị Quý
            [Dim County].[State Name].[State Name].MEMBERS,
            [Dim County].[County Name].[County Name].MEMBERS
        )
    ) ON ROWS
FROM [AQI DDS];


WITH 
MEMBER [Measures].[Days Count] AS
    COUNT(
        NONEMPTY(
            [Dim Date].[Day].MEMBERS,
            [Measures].[Fact Aqi Count]
        )
    )

SELECT 
    NONEMPTY(
        ORDER(
            CROSSJOIN(
                [Dim Date].[Year].[Year].MEMBERS, -- Hiển thị Năm
                [Dim Date].[Month].[Month].MEMBERS -- Hiển thị Tháng
            ),
            [Dim Date].[Year].CURRENTMEMBER.UNIQUENAME + [Dim Date].[Month].CURRENTMEMBER.UNIQUENAME, BASC -- Sắp xếp Năm, Tháng tăng dần
        )
    ) ON COLUMNS,
    NONEMPTY(
        CROSSJOIN(
            [Dim County].[State Name].[State Name].MEMBERS, -- Hiển thị State
            [Dim Category].[Category Name].[Category Name].MEMBERS -- Hiển thị Category
        )
    ) ON ROWS
FROM [AQI DDS]
WHERE [Measures].[Fact Aqi Count];










